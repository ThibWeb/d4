// Generated by CoffeeScript 1.4.0
(function() {

  console.log('Stats-side');

  $(function() {
    var mean, median, prettifyDim, prettifyObs, variance;
    mean = function(d) {
      var sum;
      sum = _.reduce(d, (function(acc, v) {
        return acc + v;
      }), 0);
      return sum / d.length;
    };
    median = function(d) {
      var med, sorted;
      sorted = _.sortBy(d, function(num) {
        return num;
      });
      med = sorted[Math.floor(sorted.length / 2)];
      return d.indexOf(med);
    };
    variance = function(tmpMean, d) {
      var squareSum;
      squareSum = _.reduce(d, (function(acc, v) {
        return acc + v * v;
      }), 0);
      return (squareSum / d.length) - tmpMean * tmpMean;
    };
    prettifyDim = function(dim) {
      if (_.startsWith(dim, 'http://')) {
        return _.humanize(_.strRightBack(dim, '/'));
      } else {
        return _.titleize(_.swapCase(dim));
      }
    };
    prettifyObs = function(obs) {
      return _.numberFormat(_.toNumber(Math.round(obs)), 0, decimalSeparator, thousandsSeparator);
    };
    return $('.observation-stats').each(function() {
      var $this, index, max, maxDim, medianIndex, min, minDim, range, tmpMean, tmpMedian, tmpMedianDim, tmpSd, tmpVar;
      $this = $(this);
      index = $this.attr('data-index');
      tmpMean = mean(data[index][1]);
      $('.stats' + index + '.stats-mean').html(prettifyObs(tmpMean));
      medianIndex = median(data[index][1]);
      tmpMedian = data[index][1][medianIndex];
      tmpMedianDim = prettifyDim(data[index][0][medianIndex]);
      $('.stats' + index + '.stats-median').html((prettifyObs(tmpMedian)) + ' &mdash; ' + tmpMedianDim);
      min = _.min(data[index][1]);
      minDim = prettifyDim(data[index][0][data[index][1].indexOf(min)]);
      $('.stats' + index + '.stats-min').html((prettifyObs(min)) + ' &mdash; ' + minDim);
      max = _.max(data[index][1]);
      maxDim = prettifyDim(data[index][0][data[index][1].indexOf(max)]);
      $('.stats' + index + '.stats-max').html((prettifyObs(max)) + ' &mdash; ' + maxDim);
      range = max - min;
      $('.stats' + index + '.stats-range').html(prettifyObs(range));
      tmpVar = variance(tmpMean, data[index][1]);
      $('.stats' + index + '.stats-var').html(prettifyObs(tmpVar));
      tmpSd = Math.sqrt(tmpVar);
      $('.stats' + index + '.stats-sdev').html(prettifyObs(tmpSd));
    });
  });

}).call(this);
